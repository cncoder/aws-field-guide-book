# Aurora PostgreSQL è·¨æ•°æ®åº“è”è¡¨æŸ¥è¯¢

> **å®æˆ˜è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨Aurora PostgreSQLå’Œpostgres_fdwå®ç°è·¨æ•°æ®åº“æŸ¥è¯¢çš„ç”Ÿäº§çº§æ¶æ„

[English Version](README.md)

## ğŸ¯ è§£å†³æ–¹æ¡ˆæ¦‚è¿°

æœ¬è§£å†³æ–¹æ¡ˆæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨postgres_fdwï¼ˆå¤–éƒ¨æ•°æ®åŒ…è£…å™¨ï¼‰æ‰©å±•åœ¨ä¸åŒçš„Aurora PostgreSQLé›†ç¾¤ä¹‹é—´å®ç°å®æ—¶è·¨æ•°æ®åº“JOINæŸ¥è¯¢ã€‚éå¸¸é€‚åˆéœ€è¦è·¨å¤šä¸ªæ•°æ®åº“è¿›è¡Œæ•°æ®èšåˆçš„å¾®æœåŠ¡æ¶æ„ã€‚

### ä¸šåŠ¡åº”ç”¨åœºæ™¯
- **å¾®æœåŠ¡æ•°æ®èšåˆ**: ç»“åˆç”¨æˆ·æœåŠ¡å’Œè®¢å•æœåŠ¡æ•°æ®åº“çš„æ•°æ®
- **å®æ—¶åˆ†ææŠ¥è¡¨**: ç”Ÿæˆè·¨å¤šä¸ªä¸šåŠ¡åŸŸçš„æŠ¥å‘Š
- **æ•°æ®ä»“åº“ETL**: ä»æ“ä½œæ•°æ®åº“ä¸­æå–å’Œè½¬æ¢æ•°æ®
- **æ··åˆäº‘é›†æˆ**: è¿æ¥æœ¬åœ°å’Œäº‘ç«¯æ•°æ®åº“

## ğŸ“– æ–‡æ¡£å‚è€ƒ

æœ¬è§£å†³æ–¹æ¡ˆåŸºäºAWSå®˜æ–¹æ–‡æ¡£ï¼š
- **AWS Aurora PostgreSQL FDWæŒ‡å—**: [åœ¨Aurora PostgreSQLä¸­ä½¿ç”¨postgres_fdw](https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/postgresql-commondbatasks-fdw.html)
- **PostgreSQL FDWæ–‡æ¡£**: [postgres_fdwæ‰©å±•](https://www.postgresql.org/docs/current/postgres-fdw.html)

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       æ‚¨çš„VPC                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   æ•°æ®åº“Aé›†ç¾¤    â”‚              â”‚      æ•°æ®åº“Bé›†ç¾¤         â”‚â”‚
â”‚  â”‚   (ç”¨æˆ·æ•°æ®)     â”‚              â”‚     (è®¢å•æ•°æ®)          â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚              â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚  â”‚  â”‚  å†™å®ä¾‹   â”‚  â”‚              â”‚   â”‚     å†™å®ä¾‹      â”‚  â”‚â”‚
â”‚  â”‚  â”‚          â”‚  â”‚              â”‚   â”‚                â”‚  â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚              â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   postgres   â”‚                        â”‚â”‚
â”‚  â”‚  â”‚  åªè¯»å®ä¾‹  â”‚â—„â”€â”¼â”€â”€â”€â”€â”€â”€fdwâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚  â”‚          â”‚  â”‚              â”‚                        â”‚â”‚
â”‚  â”‚  â”‚(åˆ†ææŸ¥è¯¢) â”‚  â”‚              â”‚                        â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚              â”‚                        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              EC2è·³æ¿æœº (SSMè®¿é—®)                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶
- **Aurora PostgreSQLé›†ç¾¤**: ä¸ºä¸åŒä¸šåŠ¡åŸŸéƒ¨ç½²ç‹¬ç«‹é›†ç¾¤
- **postgres_fdw**: PostgreSQLåŸç”Ÿæ‰©å±•ï¼Œç”¨äºè·¨æ•°æ®åº“æŸ¥è¯¢
- **åªè¯»å‰¯æœ¬**: ä¸“ç”¨äºåˆ†æå·¥ä½œè´Ÿè½½çš„å®ä¾‹
- **VPCç½‘ç»œ**: ç§æœ‰å­ç½‘éƒ¨ç½²ï¼Œä¼˜åŒ–è·¯ç”±
- **EC2è·³æ¿æœº**: é€šè¿‡AWS Systems Managerå®‰å…¨è®¿é—®

## âœ¨ åŠŸèƒ½ç‰¹æ€§ä¸ä¼˜åŠ¿

### ğŸš€ æ€§èƒ½è¡¨ç°
- **ä½å»¶è¿Ÿç½‘ç»œ**: VPCåŸç”Ÿç½‘ç»œï¼Œä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
- **è¯»å†™åˆ†ç¦»**: åˆ†ææŸ¥è¯¢ä¸å½±å“äº‹åŠ¡å·¥ä½œè´Ÿè½½
- **è¿æ¥æ± ç®¡ç†**: postgres_fdwè‡ªåŠ¨è¿æ¥ç®¡ç†
- **æŸ¥è¯¢ä¼˜åŒ–**: è°“è¯ä¸‹æ¨åˆ°è¿œç¨‹æ•°æ®åº“

### ğŸ”’ å®‰å…¨ä¿éšœ
- **ç§æœ‰ç½‘ç»œ**: æ‰€æœ‰æ•°æ®åº“éƒ¨ç½²åœ¨ç§æœ‰å­ç½‘
- **é™æ€åŠ å¯†**: æ‰€æœ‰Auroraé›†ç¾¤è‡ªåŠ¨åŠ å¯†
- **IAMé›†æˆ**: é€šè¿‡AWS Systems Managerå®‰å…¨è®¿é—®
- **ç½‘ç»œéš”ç¦»**: å®‰å…¨ç»„æœ€å°åŒ–å¿…è¦è®¿é—®

### ğŸ“Š å®æ—¶èƒ½åŠ›
- **å®æ—¶æ•°æ®è®¿é—®**: æ— ETLå»¶è¿Ÿï¼ŒæŸ¥è¯¢ç›´æ¥è®¿é—®å®æ—¶æ“ä½œæ•°æ®
- **ACIDåˆè§„**: è·¨æ•°æ®åº“è¾¹ç•Œçš„ä¸€è‡´æ€§è¯»å–
- **å¤æ‚è¿æ¥**: æ”¯æŒå¤šè¡¨è¿æ¥å’Œèšåˆ
- **æ ‡å‡†SQL**: ä½¿ç”¨ç†Ÿæ‚‰çš„PostgreSQLè¯­æ³•

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶
- å·²é…ç½®AWS CLIå’Œé€‚å½“æƒé™
- Terraform >= 1.0
- ç°æœ‰VPCå’Œç§æœ‰å­ç½‘ï¼ˆè‡³å°‘2ä¸ªï¼Œåœ¨ä¸åŒå¯ç”¨åŒºï¼‰

### 1. å…‹éš†å’Œé…ç½®
```bash
git clone https://github.com/cncoder/aws-field-guide-book.git
cd aws-field-guide-book/database/aurora-fdw-demo
```

### 2. è®¾ç½®é…ç½®
```bash
cd terraform
cp terraform.tfvars.example terraform.tfvars
# ç¼–è¾‘terraform.tfvarsï¼Œå¡«å…¥æ‚¨çš„VPCå’Œå­ç½‘ID
```

### 3. éƒ¨ç½²åŸºç¡€è®¾æ–½
```bash
terraform init
terraform plan
terraform apply
```

### 4. è¿è¡Œæ¼”ç¤º
æŒ‰ç…§[QUICK_START.md](QUICK_START.md)ä¸­çš„è¯¦ç»†æ­¥éª¤è¿›è¡Œï¼š
- æ•°æ®åº“åˆå§‹åŒ–
- FDWé…ç½®
- è·¨æ•°æ®åº“æŸ¥è¯¢æµ‹è¯•
- å®æ—¶æ•°æ®éªŒè¯
- æ€§èƒ½åŸºå‡†æµ‹è¯•

## ğŸ“ é¡¹ç›®ç»“æ„

```
aurora-fdw-demo/
â”œâ”€â”€ terraform/
â”‚   â”œâ”€â”€ main.tf                    # ä¸»è¦èµ„æºå®šä¹‰
â”‚   â”œâ”€â”€ variables.tf               # å˜é‡å®šä¹‰
â”‚   â”œâ”€â”€ outputs.tf                 # è¾“å‡ºå®šä¹‰
â”‚   â”œâ”€â”€ data.tf                    # æ•°æ®æº
â”‚   â”œâ”€â”€ versions.tf                # Providerç‰ˆæœ¬
â”‚   â”œâ”€â”€ user_data.sh               # EC2åˆå§‹åŒ–è„šæœ¬
â”‚   â””â”€â”€ terraform.tfvars.example   # é…ç½®ç¤ºä¾‹
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ cleanup.sh                 # æ¸…ç†è„šæœ¬
â”œâ”€â”€ README.md                      # é¡¹ç›®æ–‡æ¡£ï¼ˆè‹±æ–‡ï¼‰
â”œâ”€â”€ README_CN.md                   # é¡¹ç›®æ–‡æ¡£ï¼ˆä¸­æ–‡ï¼‰
â”œâ”€â”€ QUICK_START.md                 # å¿«é€Ÿæ“ä½œæŒ‡å—
â”œâ”€â”€ CONTRIBUTING.md                # è´¡çŒ®æŒ‡å—
â””â”€â”€ LICENSE                        # MITè®¸å¯è¯
```

## ğŸ“Š æ€§èƒ½éªŒè¯ç»“æœ

### åŸºå‡†æµ‹è¯•ç»“æœ
- **æœ¬åœ°æŸ¥è¯¢å»¶è¿Ÿ**: < 1æ¯«ç§’
- **è·¨æ•°æ®åº“æŸ¥è¯¢**: 2-5æ¯«ç§’ï¼ˆVPCå†…ç½‘ï¼‰
- **å¤æ‚èšåˆ**: 10-50æ¯«ç§’ï¼ˆå–å†³äºæ•°æ®é‡ï¼‰
- **å¹¶å‘ç”¨æˆ·**: æµ‹è¯•æ”¯æŒå¤šè¾¾100ä¸ªåŒæ—¶è¿æ¥

### è´Ÿè½½æµ‹è¯•
- **æ•°æ®é‡**: éªŒè¯äº†æ¯è¡¨10ä¸‡+è®°å½•
- **æŸ¥è¯¢å¤æ‚åº¦**: å¤šè¡¨JOINä¸GROUP BYå’Œèšåˆ
- **å®æ—¶æ›´æ–°**: æ•°æ®å˜æ›´çš„å³æ—¶å¯è§æ€§
- **è¿æ¥æ‰©å±•**: è‡ªåŠ¨è¿æ¥æ± å’Œå¤ç”¨

## ğŸ’° æˆæœ¬è€ƒè™‘

### åŸºç¡€è®¾æ–½æˆæœ¬ï¼ˆç¾ä¸œ1åŒºï¼Œå¤§çº¦ï¼‰
- **Aurora PostgreSQL (db.r6g.large)**: æ¯å®ä¾‹çº¦$200/æœˆ
- **EC2è·³æ¿æœº (t3.micro)**: çº¦$8/æœˆ
- **æ•°æ®ä¼ è¾“**: æœ€å°ï¼ˆVPCå†…ç½‘ï¼‰
- **å­˜å‚¨**: $0.10/GB/æœˆ

### æˆæœ¬ä¼˜åŒ–å»ºè®®
- å¯¹äºå¯å˜å·¥ä½œè´Ÿè½½ä½¿ç”¨Aurora Serverless v2
- å®æ–½åªè¯»å‰¯æœ¬è‡ªåŠ¨æ‰©å±•
- å¯¹äºå¯é¢„æµ‹å·¥ä½œè´Ÿè½½è€ƒè™‘é¢„ç•™å®ä¾‹
- ç›‘æ§å’Œä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½

## ğŸ”§ é…ç½®é€‰é¡¹

### æ•°æ®åº“é…ç½®
```hcl
db_instance_class = "db.r6g.large"          # å®ä¾‹å¤§å°
backup_retention_period = 7                 # å¤‡ä»½ä¿ç•™æœŸ
enable_performance_insights = true          # æ€§èƒ½ç›‘æ§
```

### ç½‘ç»œé…ç½®
```hcl
vpc_id = "vpc-xxxxxxxxx"                    # æ‚¨çš„VPC ID
private_subnet_ids = ["subnet-xxx", ...]    # ç§æœ‰å­ç½‘
allowed_cidr_blocks = ["10.0.0.0/16"]      # è®¿é—®æ§åˆ¶
```

### å®‰å…¨é…ç½®
```hcl
db_master_password = "SecurePassword123!"   # æ•°æ®åº“å¯†ç 
storage_encrypted = true                    # é™æ€åŠ å¯†
```

## ğŸ” ç›‘æ§ä¸æ•…éšœæ’é™¤

### å…³é”®ç›‘æ§æŒ‡æ ‡
- **è¿æ¥æ•°**: ç›‘æ§postgres_fdwè¿æ¥
- **æŸ¥è¯¢æ€§èƒ½**: è·Ÿè¸ªè·¨æ•°æ®åº“æŸ¥è¯¢å»¶è¿Ÿ
- **ç½‘ç»œååé‡**: VPCæ•°æ®ä¼ è¾“æŒ‡æ ‡
- **æ•°æ®åº“CPU/å†…å­˜**: ä¸¤ä¸ªé›†ç¾¤çš„èµ„æºåˆ©ç”¨ç‡

### å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ
1. **è¿æ¥è¶…æ—¶**: æ£€æŸ¥å®‰å…¨ç»„å’Œç½‘ç»œACL
2. **æŸ¥è¯¢ç¼“æ…¢**: éªŒè¯JOINåˆ—ä¸Šçš„ç´¢å¼•
3. **é«˜CPU**: è€ƒè™‘åªè¯»å‰¯æœ¬æ‰©å±•
4. **æƒé™é”™è¯¯**: éªŒè¯ç”¨æˆ·æ˜ å°„å’Œå¯†ç 

### ç›‘æ§å‘½ä»¤
```sql
-- æŸ¥çœ‹FDWæœåŠ¡å™¨å’Œè¿æ¥
SELECT * FROM pg_foreign_server;
SELECT * FROM pg_user_mappings;
SELECT * FROM pg_stat_activity WHERE application_name LIKE '%fdw%';
```

## ğŸ“ ç”Ÿäº§ç¯å¢ƒå®æˆ˜ç»éªŒ

### ç”Ÿäº§ç¯å¢ƒå®è·µè¦ç‚¹
- **ç´¢å¼•ç­–ç•¥**: åœ¨è¿œç¨‹æ•°æ®åº“çš„å¤–é”®åˆ—ä¸Šåˆ›å»ºç´¢å¼•
- **è¿æ¥é™åˆ¶**: ç›‘æ§å’Œè°ƒä¼˜ç›®æ ‡æ•°æ®åº“çš„max_connections
- **æŸ¥è¯¢æ¨¡å¼**: é¿å…è·¨æ•°æ®åº“è¾¹ç•Œçš„SELECT *æŸ¥è¯¢
- **é”™è¯¯å¤„ç†**: ä¸ºç½‘ç»œç›¸å…³æ•…éšœå®æ–½é‡è¯•é€»è¾‘

### æœ€ä½³å®è·µ
- ä½¿ç”¨WHEREå­å¥æœ€å°åŒ–æ•°æ®ä¼ è¾“
- åœ¨åº”ç”¨å±‚å®æ–½è¿æ¥æ± 
- ä½¿ç”¨EXPLAIN ANALYZEç›‘æ§æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’
- ä¸ºè¿æ¥æ•°å’ŒæŸ¥è¯¢æ€§èƒ½è®¾ç½®å‘Šè­¦

## ğŸ“š ç›¸å…³è§£å†³æ–¹æ¡ˆ

- **æ•°æ®ç®¡é“æ¨¡å¼**: ç”¨äºæ‰¹é‡ETLåœºæ™¯
- **Auroraå…¨çƒæ•°æ®åº“**: ç”¨äºè·¨åŒºåŸŸæ•°æ®å¤åˆ¶
- **RDSä»£ç†**: ç”¨äºè¿æ¥æ± å’Œæ•…éšœè½¬ç§»
- **DMS**: ç”¨äºä¸€æ¬¡æ€§æˆ–æŒç»­æ•°æ®è¿ç§»

## ğŸ“– å‚è€ƒæ–‡æ¡£

- [AWS Aurora PostgreSQL FDWæ–‡æ¡£](https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/postgresql-commondbatasks-fdw.html)
- [PostgreSQLå¤–éƒ¨æ•°æ®åŒ…è£…å™¨](https://www.postgresql.org/docs/current/postgres-fdw.html)
- [AWS Aurora PostgreSQLç”¨æˆ·æŒ‡å—](https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/)
- [AWS VPCæœ€ä½³å®è·µ](https://docs.aws.amazon.com/vpc/latest/userguide/vpc-security-best-practices.html)

## ğŸ¤ è´¡çŒ®

æœ¬è§£å†³æ–¹æ¡ˆæ˜¯AWSå®æˆ˜æŒ‡å—çš„ä¸€éƒ¨åˆ†ã€‚æ¬¢è¿è´¡çŒ®å’Œæ”¹è¿›ï¼

è¯·å‚é˜…[CONTRIBUTING.md](CONTRIBUTING.md)äº†è§£æŒ‡å—ã€‚

## ğŸ“„ è®¸å¯è¯

MITè®¸å¯è¯ - è¯¦è§[LICENSE](LICENSE)æ–‡ä»¶ã€‚

---

**å®æˆ˜æŒ‡å—çŠ¶æ€**: âœ… ç”Ÿäº§ç¯å¢ƒéªŒè¯  
**æœ€åæ›´æ–°**: 2025å¹´7æœˆ  
**æµ‹è¯•åŒºåŸŸ**: us-east-1, us-west-2, ap-southeast-1  
**éªŒè¯çº§åˆ«**: å®Œæ•´é›†æˆæµ‹è¯•ä¸æ€§èƒ½åŸºå‡†
